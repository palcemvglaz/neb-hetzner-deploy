import { notFound } from 'next/navigation'
import Link from 'next/link'
import { getServerSession } from 'next-auth'
import { authOptions } from '@/lib/auth'
import { prisma } from '@/lib/db/prisma'
import { 
  Clock, BookOpen, Users, Star, Award, Play, 
  CheckCircle, Lock, ChevronDown, ChevronUp,
  BarChart, Target, Shield, Zap, AlertCircle
} from 'lucide-react'
import CoursePageClient from './course-page-client'

interface CoursePageProps {
  params: { slug: string }
}

async function getCourse(slug: string) {
  const course = await prisma.course.findUnique({
    where: { slug },
    include: {
      translations: {
        where: { language: 'UA' }
      },
      sections: {
        include: {
          items: {
            include: {
              content: true // Include content to get real titles
            },
            orderBy: { order: 'asc' }
          }
        },
        orderBy: { order: 'asc' }
      },
      enrollments: {
        select: { id: true }
      },
      reviews: {
        select: { rating: true }
      }
    }
  })

  return course
}

async function getUserProgress(courseId: string, userId: string) {
  // For now, return empty progress as lesson structure needs refactoring
  const progress: any[] = []

  return progress
}

export default async function CoursePage({ params }: CoursePageProps) {
  const session = await getServerSession(authOptions)
  const course = await getCourse(params.slug)

  if (!course) {
    notFound()
  }

  // Get user enrollment and progress if logged in
  let enrollment = null
  let userProgress = []
  
  if (session?.user) {
    enrollment = await prisma.enrollment.findUnique({
      where: {
        userId_courseId: {
          userId: session.user.id,
          courseId: course.id
        }
      }
    })

    if (enrollment) {
      userProgress = await getUserProgress(course.id, session.user.id)
    }
  }

  // Calculate course statistics
  const totalLessons = course.sections.reduce((acc, section) => 
    acc + section.items.length, 0
  )
  
  const completedLessons = userProgress.filter(p => p.isCompleted).length
  const progress = totalLessons > 0 ? Math.round((completedLessons / totalLessons) * 100) : 0

  const averageRating = course.reviews.length > 0
    ? course.reviews.reduce((acc, r) => acc + r.rating, 0) / course.reviews.length
    : 0

  const totalDuration = course.sections.reduce((acc, section) => 
    acc + section.items.reduce((lAcc, item) => lAcc + 0, 0), 0 // Items don't have duration property
  )

  // Get course-specific data based on slug
  const getCourseData = (slug: string) => {
    switch(slug) {
      case 'motorcycle-safety-concepts':
        return {
          title: "8 –∫–æ–Ω—Ü–µ–ø—Ç—ñ–≤ –±–µ–∑–ø–µ–∫–∏ –º–æ—Ç–æ—Ü–∏–∫–ª—ñ—Å—Ç–∞",
          description: "üíÄ –§–£–ù–î–ê–ú–ï–ù–¢–ê–õ–¨–ù–Ü –ø—Ä–∏–Ω—Ü–∏–ø–∏, —è–∫—ñ –≤—ñ–¥–æ–∫—Ä–µ–º–ª—é—é—Ç—å –∂–∏–≤–∏—Ö –º–æ—Ç–æ—Ü–∏–∫–ª—ñ—Å—Ç—ñ–≤ –≤—ñ–¥ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏. –ó–∞—Å–Ω–æ–≤–∞–Ω–∏–π –Ω–∞ –∞–Ω–∞–ª—ñ–∑—ñ 10,000+ –∞–≤–∞—Ä—ñ–π.",
          longDescription: `üö® –£–í–ê–ì–ê: –¶–µ–π –∫—É—Ä—Å —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –Ω–∞ –æ—Å–Ω–æ–≤—ñ –∞–Ω–∞–ª—ñ–∑—É 10,000+ —Ä–µ–∞–ª—å–Ω–∏—Ö –∞–≤–∞—Ä—ñ–π!

üíÄ –®–û–ö–£–Æ–ß–ê –°–¢–ê–¢–ò–°–¢–ò–ö–ê:
‚Ä¢ 87% –º–æ—Ç–æ—Ü–∏–∫–ª—ñ—Å—Ç—ñ–≤ –ø–æ—Ç—Ä–∞–ø–ª—è—é—Ç—å –≤ –∞–≤–∞—Ä—ñ—ó –≤ –ø–µ—Ä—à—ñ 2 —Ä–æ–∫–∏
‚Ä¢ 94% –∞–≤–∞—Ä—ñ–π –º–æ–∂–Ω–∞ –±—É–ª–æ —É–Ω–∏–∫–Ω—É—Ç–∏, –∑–Ω–∞—é—á–∏ —Ü—ñ 8 –∫–æ–Ω—Ü–µ–ø—Ç—ñ–≤
‚Ä¢ –ú–æ—Ç–æ—Ü–∏–∫–ª—ñ—Å—Ç–∏ –≤ 27 —Ä–∞–∑—ñ–≤ —á–∞—Å—Ç—ñ—à–µ –≥–∏–Ω—É—Ç—å –Ω–∞ –¥–æ—Ä–æ–∑—ñ –Ω—ñ–∂ –∞–≤—Ç–æ–º–æ–±—ñ–ª—ñ—Å—Ç–∏

‚ùå –©–û –ù–ï –ü–†–ê–¶–Æ–Ñ:
‚ùå –ú–æ—Ç–æ—à–∫–æ–ª–∏ –Ω–∞–≤—á–∞—é—Ç—å –∫–µ—Ä—É–≤–∞—Ç–∏, –∞–ª–µ –ù–ï –Ω–∞–≤—á–∞—é—Ç—å –≤–∏–∂–∏–≤–∞—Ç–∏
‚ùå "–ë—É—Ç–∏ –æ–±–µ—Ä–µ–∂–Ω–∏–º" - –ù–ï —Å—Ç—Ä–∞—Ç–µ–≥—ñ—è
‚ùå –ü–æ–∫–ª–∞–¥–∞—Ç–∏—Å—è –Ω–∞ —É–¥–∞—á—É —Ç–∞ "–º–æ–∂–µ –ø—Ä–æ–Ω–µ—Å–µ"

‚úÖ –©–û –ù–ê–°–ü–†–ê–í–î–Ü –ü–†–ê–¶–Æ–Ñ - 8 –ö–û–ù–¶–ï–ü–¢–Ü–í:
üéØ VISION - –ë–∞—á–∏—Ç–∏ –Ω–µ–±–µ–∑–ø–µ–∫—É –î–û –∑—ñ—Ç–∫–Ω–µ–Ω–Ω—è
‚ö° SPEED - –®–≤–∏–¥–∫—ñ—Å—Ç—å —è–∫ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –±–µ–∑–ø–µ–∫–∏
üõ°Ô∏è SPACE - –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞—Ö–∏—Å–Ω–æ–≥–æ –ø—Ä–æ—Å—Ç–æ—Ä—É
‚öñÔ∏è STABILITY - –ö–æ–Ω—Ç—Ä–æ–ª—å –≤ –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö —Å–∏—Ç—É–∞—Ü—ñ—è—Ö
üß† CONCENTRATION - –ú–µ–Ω—Ç–∞–ª—å–Ω–∞ –¥–∏—Å—Ü–∏–ø–ª—ñ–Ω–∞
üí™ RESPONSIBILITY - –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω—ñ—Å—Ç—å
üé≤ STRATEGY - –¢–∞–∫—Ç–∏—á–Ω–µ –º–∏—Å–ª–µ–Ω–Ω—è
üî• SURVIVAL - –Ü–Ω—Å—Ç–∏–Ω–∫—Ç —Å–∞–º–æ–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è

üî• –©–û –í–ò –û–¢–†–ò–ú–ê–Ñ–¢–ï:
‚Ä¢ –°–∏—Å—Ç–µ–º—É —Ä–∞–Ω–Ω—å–æ–≥–æ –≤–∏—è–≤–ª–µ–Ω–Ω—è –Ω–µ–±–µ–∑–ø–µ–∫ (–∑–∞ 5-7 —Å–µ–∫—É–Ω–¥ –¥–æ –∫—Ä–∏—Ç–∏—á–Ω–æ—ó —Å–∏—Ç—É–∞—Ü—ñ—ó)
‚Ä¢ –ú–µ–Ω—Ç–∞–ª—å–Ω—ñ –º–æ–¥–µ–ª—ñ –¥–ª—è –º–∏—Ç—Ç—î–≤–æ–≥–æ –ø—Ä–∏–π–Ω—è—Ç—Ç—è —Ä—ñ—à–µ–Ω—å
‚Ä¢ –°—Ç—Ä–∞—Ç–µ–≥—ñ—ó –ø–æ–∑–∏—Ü—ñ–æ–Ω—É–≤–∞–Ω–Ω—è, —â–æ —Ä–æ–±–ª—è—Ç—å –≤–∞—Å "–Ω–µ–≤–∏–¥–∏–º–∏–º" –¥–ª—è –∞–≤–∞—Ä—ñ–π
‚Ä¢ –¢–µ—Ö–Ω—ñ–∫–∏ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Ä–∏–∑–∏–∫–∞–º–∏ –Ω–∞ 90%+

üí∞ –í–ê–†–¢–Ü–°–¢–¨ –ü–û–ú–ò–õ–ö–ò: $10,000-100,000+ (–ª—ñ–∫—É–≤–∞–Ω–Ω—è) + –≤–∞—à–µ –∂–∏—Ç—Ç—è
üí∞ –í–ê–†–¢–Ü–°–¢–¨ –ö–£–†–°–£: –ë–ï–ó–ö–û–®–¢–û–í–ù–û

‚ö° –ì–ê–†–ê–ù–¢–û–í–ê–ù–ò–ô –†–ï–ó–£–õ–¨–¢–ê–¢: –ó–º–µ–Ω—à–µ–Ω–Ω—è —Ä–∏–∑–∏–∫—É –∞–≤–∞—Ä—ñ—ó –Ω–∞ 94% –∞–±–æ –≤–∞—à—ñ –≥—Ä–æ—à—ñ –Ω–∞–∑–∞–¥!`,
          category: '–§—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–∞ –±–µ–∑–ø–µ–∫–∞',
          whatYouLearn: [
            'üéØ VISION: –°–∏—Å—Ç–µ–º—É —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è –¥–æ—Ä–æ–≥–∏ —Ç–∞ —Ä–∞–Ω–Ω—å–æ–≥–æ –≤–∏—è–≤–ª–µ–Ω–Ω—è –Ω–µ–±–µ–∑–ø–µ–∫',
            '‚ö° SPEED: –Ø–∫ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —à–≤–∏–¥–∫—ñ—Å—Ç—å —è–∫ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –±–µ–∑–ø–µ–∫–∏, –∞ –Ω–µ –∑–∞–≥—Ä–æ–∑—É',
            'üõ°Ô∏è SPACE: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∑–∞—Ö–∏—Å–Ω–∏–º –ø—Ä–æ—Å—Ç–æ—Ä–æ–º –Ω–∞–≤–∫–æ–ª–æ –º–æ—Ç–æ—Ü–∏–∫–ª–∞',
            '‚öñÔ∏è STABILITY: –ü—ñ–¥—Ç—Ä–∏–º–∞–Ω–Ω—è –∫–æ–Ω—Ç—Ä–æ–ª—é –≤ –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö —Ç–∞ –Ω–µ—Å–ø–æ–¥—ñ–≤–∞–Ω–∏—Ö —Å–∏—Ç—É–∞—Ü—ñ—è—Ö',
            'üß† CONCENTRATION: –ú–µ–Ω—Ç–∞–ª—å–Ω—É –¥–∏—Å—Ü–∏–ø–ª—ñ–Ω—É —Ç–∞ —Ñ–æ–∫—É—Å –¥–ª—è —Ç—Ä–∏–≤–∞–ª–∏—Ö –ø–æ—ó–∑–¥–æ–∫',
            'üí™ RESPONSIBILITY: –ü—Ä–∏–π–Ω—è—Ç—Ç—è 100% –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–æ—Å—Ç—ñ –∑–∞ —Å–≤–æ—é –±–µ–∑–ø–µ–∫—É',
            'üé≤ STRATEGY: –¢–∞–∫—Ç–∏—á–Ω–µ –ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è –º–∞—Ä—à—Ä—É—Ç—É —Ç–∞ –ø—Ä–æ–≥–Ω–æ–∑—É–≤–∞–Ω–Ω—è —Ä–∏–∑–∏–∫—ñ–≤',
            'üî• SURVIVAL: –†–æ–∑–≤–∏—Ç–æ–∫ —ñ–Ω—Å—Ç–∏–Ω–∫—Ç—É —Å–∞–º–æ–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ç–∞ —à–≤–∏–¥–∫–æ–≥–æ —Ä–µ–∞–≥—É–≤–∞–Ω–Ω—è'
          ],
          requirements: [
            'üèçÔ∏è –ë–∞–∑–æ–≤—ñ –Ω–∞–≤–∏—á–∫–∏ –∫–µ—Ä—É–≤–∞–Ω–Ω—è –º–æ—Ç–æ—Ü–∏–∫–ª–æ–º (–∑–¥–∞–Ω–æ –Ω–∞ –ø—Ä–∞–≤–∞)',
            'üß† –ì–æ—Ç–æ–≤–Ω—ñ—Å—Ç—å –∑–º—ñ–Ω–∏—Ç–∏ —Å–≤—ñ–π –ø—ñ–¥—Ö—ñ–¥ –¥–æ –±–µ–∑–ø–µ–∫–∏ (50% —É—Å–ø—ñ—Ö—É)',
            'üíÄ –†–æ–∑—É–º—ñ–Ω–Ω—è, —â–æ "–º–æ–∂–µ –ø—Ä–æ–Ω–µ—Å–µ" - –ù–ï —Å—Ç—Ä–∞—Ç–µ–≥—ñ—è –≤–∏–∂–∏–≤–∞–Ω–Ω—è',
            '‚è∞ 2-3 –≥–æ–¥–∏–Ω–∏ –¥–ª—è –≤–∏–≤—á–µ–Ω–Ω—è –∫–æ–Ω—Ü–µ–ø—Ç—ñ–≤, —è–∫—ñ –≤—Ä—è—Ç—É—é—Ç—å –∂–∏—Ç—Ç—è'
          ]
        };
      case 'critical-riding-skills':
        return {
          title: "–ö—Ä–∏—Ç–∏—á–Ω—ñ –Ω–∞–≤–∏—á–∫–∏ –º–æ—Ç–æ—Ü–∏–∫–ª—ñ—Å—Ç–∞",
          description: "‚ö° –¢–ï–•–ù–Ü–ß–ù–Ü –Ω–∞–≤–∏—á–∫–∏, —è–∫—ñ —Ä—è—Ç—É—é—Ç—å –∂–∏—Ç—Ç—è –≤ –∫—Ä–∏—Ç–∏—á–Ω–∏–π –º–æ–º–µ–Ω—Ç. 3 —Å–µ–∫—É–Ω–¥–∏ –º—ñ–∂ –∂–∏—Ç—Ç—è–º —ñ —Å–º–µ—Ä—Ç—é - –±—É–¥—å—Ç–µ –≥–æ—Ç–æ–≤—ñ!",
          longDescription: `üö® –ö–†–ò–¢–ò–ß–ù–ê –°–ò–¢–£–ê–¶–Ü–Ø: –£ –≤–∞—Å —î 3 –°–ï–ö–£–ù–î–ò —â–æ–± –≤—ñ–¥—Ä–µ–∞–≥—É–≤–∞—Ç–∏!

‚ö° –®–û–ö–£–Æ–ß–Ü –§–ê–ö–¢–ò:
‚Ä¢ 90% —Å–º–µ—Ä—Ç–µ–ª—å–Ω–∏—Ö –∞–≤–∞—Ä—ñ–π –º–æ–∂–Ω–∞ —É–Ω–∏–∫–Ω—É—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–º –≥–∞–ª—å–º—É–≤–∞–Ω–Ω—è–º
‚Ä¢ –ë—ñ–ª—å—à—ñ—Å—Ç—å –º–æ—Ç–æ—Ü–∏–∫–ª—ñ—Å—Ç—ñ–≤ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å —Ç—ñ–ª—å–∫–∏ 30% –ø–æ—Ç–µ–Ω—Ü—ñ–∞–ª—É –≥–∞–ª—å–º
‚Ä¢ –ï–∫—Å—Ç—Ä–µ–Ω–µ –º–∞–Ω–µ–≤—Ä—É–≤–∞–Ω–Ω—è —Ä—è—Ç—É—î —Ç–∞–º, –¥–µ –≥–∞–ª—å–º—É–≤–∞–Ω–Ω—è –Ω–µ –¥–æ–ø–æ–º–∞–≥–∞—î

‚ùå –ü–û–ú–ò–õ–ö–ò, –Ø–ö–Ü –í–ë–ò–í–ê–Æ–¢–¨:
‚ùå "–•–≤–∞—Ç–∞–π—Å—è –∑–∞ –≥–∞–ª—å–º–∞" –∑–∞–º—ñ—Å—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—ó —Ç–µ—Ö–Ω—ñ–∫–∏
‚ùå –ü–∞–Ω—ñ—á–Ω–µ –≥–∞–ª—å–º—É–≤–∞–Ω–Ω—è —Ç—ñ–ª—å–∫–∏ –ø–µ—Ä–µ–¥–Ω—ñ–º –∫–æ–ª–µ—Å–æ–º
‚ùå –°–ø—Ä–æ–±–∞ –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ –∑–∞–º—ñ—Å—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä-—Ä—É–ª—å–æ–≤–æ–≥–æ –∫–µ—Ä—É–≤–∞–Ω–Ω—è
‚ùå –í—Ç—Ä–∞—Ç–∞ –∫–æ–Ω—Ç—Ä–æ–ª—é –Ω–∞ –º–æ–∫—Ä—ñ–π –¥–æ—Ä–æ–∑—ñ

‚úÖ –ö–†–ò–¢–ò–ß–ù–Ü –ù–ê–í–ò–ß–ö–ò –î–õ–Ø –í–ò–ñ–ò–í–ê–ù–ù–Ø:
üõë –ï–ö–°–¢–†–ï–ù–ï –ì–ê–õ–¨–ú–£–í–ê–ù–ù–Ø - –∑—É–ø–∏–Ω–∏—Ç–∏—Å—è –î–û –∑—ñ—Ç–∫–Ω–µ–Ω–Ω—è
üéØ –ö–û–ù–¢–†–û–õ–¨ –¢–ê –ë–ê–õ–ê–ù–° - —Å—Ç–∞–±—ñ–ª—å–Ω—ñ—Å—Ç—å –≤ –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö —Å–∏—Ç—É–∞—Ü—ñ—è—Ö  
üèÉ‚Äç‚ôÇÔ∏è –£–ù–ò–ö–ù–ï–ù–ù–Ø –ó–Ü–¢–ö–ù–ï–ù–¨ - —à–≤–∏–¥–∫–µ –º–∞–Ω–µ–≤—Ä—É–≤–∞–Ω–Ω—è —è–∫ –æ—Å—Ç–∞–Ω–Ω—ñ–π —à–∞–Ω—Å

üî• –©–û –í–ò –û–¢–†–ò–ú–ê–Ñ–¢–ï:
‚Ä¢ –¢–µ—Ö–Ω—ñ–∫–∏ –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∏—Ö –≥–æ–Ω—â–∏–∫—ñ–≤ –¥–ª—è –µ–∫—Å—Ç—Ä–µ–Ω–æ–≥–æ –≥–∞–ª—å–º—É–≤–∞–Ω–Ω—è
‚Ä¢ –°–µ–∫—Ä–µ—Ç–∏ –∫–æ–Ω—Ç—Ä–æ–ª—é –º–æ—Ç–æ—Ü–∏–∫–ª–∞ –≤ –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö —Å–∏—Ç—É–∞—Ü—ñ—è—Ö
‚Ä¢ –ù–∞–≤–∏—á–∫–∏ —à–≤–∏–¥–∫–æ–≥–æ –º–∞–Ω–µ–≤—Ä—É–≤–∞–Ω–Ω—è –¥–ª—è —É–Ω–∏–∫–Ω–µ–Ω–Ω—è –∑—ñ—Ç–∫–Ω–µ–Ω—å
‚Ä¢ –ü—Ä–∞–∫—Ç–∏—á–Ω—ñ –≤–ø—Ä–∞–≤–∏ –¥–ª—è –≤—ñ–¥–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è –Ω–∞–≤–∏—á–æ–∫

üí∞ –í–ê–†–¢–Ü–°–¢–¨ –ü–û–ú–ò–õ–ö–ò: –í–∞—à–µ –∂–∏—Ç—Ç—è
üí∞ –í–ê–†–¢–Ü–°–¢–¨ –ö–£–†–°–£: –ë–ï–ó–ö–û–®–¢–û–í–ù–û

‚ö° –†–ï–ó–£–õ–¨–¢–ê–¢: –í–ø–µ–≤–Ω–µ–Ω—ñ—Å—Ç—å —Ç–∞ –∫–æ–Ω—Ç—Ä–æ–ª—å –≤ –±—É–¥—å-—è–∫—ñ–π –∫—Ä–∏—Ç–∏—á–Ω—ñ–π —Å–∏—Ç—É–∞—Ü—ñ—ó!`,
          category: '–¢–µ—Ö–Ω—ñ—á–Ω—ñ –Ω–∞–≤–∏—á–∫–∏',
          whatYouLearn: [
            'üõë –¢–µ—Ö–Ω—ñ–∫—É –µ–∫—Å—Ç—Ä–µ–Ω–æ–≥–æ –≥–∞–ª—å–º—É–≤–∞–Ω–Ω—è –∑ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∏–º –µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—é',
            'üåßÔ∏è –û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ –≥–∞–ª—å–º—É–≤–∞–Ω–Ω—è –Ω–∞ –º–æ–∫—Ä—ñ–π —Ç–∞ —Å–ª–∏–∑—å–∫—ñ–π –¥–æ—Ä–æ–∑—ñ',
            'ü§ñ –ü—Ä–∞–≤–∏–ª—å–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è ABS vs —Ç—Ä–∞–¥–∏—Ü—ñ–π–Ω–∏—Ö –≥–∞–ª—å–º',
            'üéØ –ö–æ–Ω—Ç—Ä–æ–ª—å –º–æ—Ç–æ—Ü–∏–∫–ª–∞ –Ω–∞ –Ω–∏–∑—å–∫–∏—Ö —à–≤–∏–¥–∫–æ—Å—Ç—è—Ö',
            '‚öñÔ∏è –¢–µ—Ö–Ω—ñ–∫–∏ —Å—Ç–∞–±—ñ–ª—ñ–∑–∞—Ü—ñ—ó —Ç–∞ –∫–æ–Ω—Ç—Ä–æ–ª—é –±–∞–ª–∞–Ω—Å—É',
            'üí® –®–≤–∏–¥–∫—É –∑–º—ñ–Ω—É –Ω–∞–ø—Ä—è–º–∫—É –¥–ª—è —É–Ω–∏–∫–Ω–µ–Ω–Ω—è –ø–µ—Ä–µ—à–∫–æ–¥',
            'üîÑ –ú–∞–π—Å—Ç–µ—Ä–Ω—ñ—Å—Ç—å –∫–æ–Ω—Ç—Ä-—Ä—É–ª—å–æ–≤–æ–≥–æ –∫–µ—Ä—É–≤–∞–Ω–Ω—è',
            'üöÄ –ö–æ–º–±—ñ–Ω–æ–≤–∞–Ω—ñ –º–∞–Ω–µ–≤—Ä–∏: –≥–∞–ª—å–º—É–≤–∞–Ω–Ω—è + –º–∞–Ω–µ–≤—Ä—É–≤–∞–Ω–Ω—è'
          ],
          requirements: [
            'üèçÔ∏è –í–ø–µ–≤–Ω–µ–Ω–µ –∫–µ—Ä—É–≤–∞–Ω–Ω—è –º–æ—Ç–æ—Ü–∏–∫–ª–æ–º (–º—ñ–Ω—ñ–º—É–º 1000 –∫–º –¥–æ—Å–≤—ñ–¥—É)',
            'üí™ –§—ñ–∑–∏—á–Ω–∞ –≥–æ—Ç–æ–≤–Ω—ñ—Å—Ç—å –¥–æ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –Ω–∞–≤–∏—á–æ–∫',
            'üß† –†–æ–∑—É–º—ñ–Ω–Ω—è, —â–æ –Ω–∞–≤–∏—á–∫–∏ –ø–æ—Ç—Ä–µ–±—É—é—Ç—å –ø–æ—Å—Ç—ñ–π–Ω–æ—ó –ø—Ä–∞–∫—Ç–∏–∫–∏',
            '‚ö†Ô∏è –î–æ—Å—Ç—É–ø –¥–æ –±–µ–∑–ø–µ—á–Ω–æ–≥–æ –º—ñ—Å—Ü—è –¥–ª—è –ø—Ä–∞–∫—Ç–∏–∫–∏ (–º–∞–π–¥–∞–Ω—á–∏–∫/—Ç—Ä–∞—Å–∞)'
          ]
        };
      case 'beginner-rider-guide':
        return {
          title: "–ü–æ–≤–Ω–∏–π –≥—ñ–¥ –¥–ª—è –ø–æ—á–∞—Ç–∫—ñ–≤—Ü—è –º–æ—Ç–æ—Ü–∏–∫–ª—ñ—Å—Ç–∞",
          description: "üöÄ –í—ñ–¥ –ù–£–õ–Ø –¥–æ –±–µ–∑–ø–µ—á–Ω–æ–≥–æ –º–æ—Ç–æ—Ü–∏–∫–ª—ñ—Å—Ç–∞ –∑–∞ 30 –¥–Ω—ñ–≤. –£–Ω–∏–∫–Ω—ñ—Ç—å –ø–æ–º–∏–ª–æ–∫, —è–∫—ñ –∫–æ—à—Ç—É—é—Ç—å $10,000+ —Ç–∞ —Ä–æ–∫–∏ –±–æ–ª—é!",
          longDescription: `üö® –°–¢–ê–¢–ò–°–¢–ò–ö–ê, –Ø–ö–ê –®–û–ö–£–Ñ:
‚Ä¢ 67% –Ω–æ–≤–∞—á–∫—ñ–≤ –∫–∏–¥–∞—é—Ç—å –º–æ—Ç–æ—Ü–∏–∫–ª –≤ –ø–µ—Ä—à—ñ 6 –º—ñ—Å—è—Ü—ñ–≤
‚Ä¢ 45% –∫—É–ø—É—é—Ç—å –ù–ï–ü–†–ê–í–ò–õ–¨–ù–ò–ô –ø–µ—Ä—à–∏–π –º–æ—Ç–æ—Ü–∏–∫–ª
‚Ä¢ 78% –≤–∏—Ç—Ä–∞—á–∞—é—Ç—å $3,000+ –Ω–∞ –Ω–µ–ø–æ—Ç—Ä—ñ–±–Ω–µ –µ–∫—ñ–ø—ñ—Ä—É–≤–∞–Ω–Ω—è
‚Ä¢ 89% —Ä–æ–±–ª—è—Ç—å –∫—Ä–∏—Ç–∏—á–Ω—ñ –ø–æ–º–∏–ª–∫–∏ –≤ –ø–µ—Ä—à—ñ –ø–æ—ó–∑–¥–∫–∏

üí∞ –°–ö–Ü–õ–¨–ö–ò –ö–û–®–¢–£–Æ–¢–¨ –ü–û–ú–ò–õ–ö–ò:
‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –º–æ—Ç–æ—Ü–∏–∫–ª: $5,000-15,000 –≤—Ç—Ä–∞—Ç
‚ùå –ù–µ—è–∫—ñ—Å–Ω–µ –µ–∫—ñ–ø—ñ—Ä—É–≤–∞–Ω–Ω—è: $2,000-5,000 + –≤–∞—à–µ –∑–¥–æ—Ä–æ–≤'—è
‚ùå –ê–≤–∞—Ä—ñ—è —á–µ—Ä–µ–∑ –Ω–µ–∑–Ω–∞–Ω–Ω—è: $10,000-100,000+ –ª—ñ–∫—É–≤–∞–Ω–Ω—è
‚ùå –í—Ç—Ä–∞—Ç–∞ –≤–ø–µ–≤–Ω–µ–Ω–æ—Å—Ç—ñ: —Ä–æ–∫–∏ —Å—Ç—Ä–∞—Ö—É —Ç–∞ –æ–±–º–µ–∂–µ–Ω—å

‚úÖ –ü–†–ê–í–ò–õ–¨–ù–ò–ô –°–¢–ê–†–¢ - 3 –ï–¢–ê–ü–ò:
üèçÔ∏è –í–ò–ë–Ü–† –ú–û–¢–û–¶–ò–ö–õ–ê - —è–∫–∏–π –Ω–∞—Å–ø—Ä–∞–≤–¥—ñ –ø–æ—Ç—Ä—ñ–±–µ–Ω –Ω–æ–≤–∞—á–∫—É
üõ°Ô∏è –ï–ö–Ü–ü–Ü–†–£–í–ê–ù–ù–Ø - —â–æ –Ω–∞—Å–ø—Ä–∞–≤–¥—ñ –∑–∞—Ö–∏—â–∞—î vs –º–∞—Ä–∫–µ—Ç–∏–Ω–≥
üöÄ –ü–ï–†–®–Ü –ö–†–û–ö–ò - –≤—ñ–¥ –º–æ—Ç–æ—à–∫–æ–ª–∏ –¥–æ –≤–ø–µ–≤–Ω–µ–Ω–æ—ó —ó–∑–¥–∏

üî• –©–û –í–ò –û–¢–†–ò–ú–ê–Ñ–¢–ï:
‚Ä¢ –ü–æ–∫—Ä–æ–∫–æ–≤—É —Å–∏—Å—Ç–µ–º—É –≤–∏–±–æ—Ä—É –ü–†–ê–í–ò–õ–¨–ù–û–ì–û –ø–µ—Ä—à–æ–≥–æ –º–æ—Ç–æ—Ü–∏–∫–ª–∞
‚Ä¢ –°–µ–∫—Ä–µ—Ç–∏ –≤–∏–±–æ—Ä—É –µ–∫—ñ–ø—ñ—Ä—É–≤–∞–Ω–Ω—è, —è–∫—ñ –∑–Ω–∞—é—Ç—å —Ç—ñ–ª—å–∫–∏ –ø—Ä–æ—Ñ–µ—Å—ñ–æ–Ω–∞–ª–∏
‚Ä¢ –ü–ª–∞–Ω –ø–µ—Ä—à–∏—Ö 30 –¥–Ω—ñ–≤ –¥–ª—è –±–µ–∑–ø–µ—á–Ω–æ–≥–æ –≤—Ö–æ–¥–∂–µ–Ω–Ω—è –≤ –º–æ—Ç–æ—Ü–∏–∫–ª–µ—Ç–Ω–∏–π —Å–≤—ñ—Ç
‚Ä¢ –°–ø–∏—Å–æ–∫ –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –ø–æ–º–∏–ª–æ–∫ —Ç–∞ —è–∫ —ó—Ö —É–Ω–∏–∫–Ω—É—Ç–∏

üí∞ –ï–ö–û–ù–û–ú–Ü–Ø: $10,000-20,000 –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö —Ä—ñ—à–µ–Ω–Ω—è—Ö
üí∞ –í–ê–†–¢–Ü–°–¢–¨ –ö–£–†–°–£: –ë–ï–ó–ö–û–®–¢–û–í–ù–û

‚ö° –†–ï–ó–£–õ–¨–¢–ê–¢: –í–ø–µ–≤–Ω–µ–Ω–∏–π —Å—Ç–∞—Ä—Ç –±–µ–∑ –¥–æ—Ä–æ–≥–∏—Ö –ø–æ–º–∏–ª–æ–∫!`,
          category: '–î–ª—è –ø–æ—á–∞—Ç–∫—ñ–≤—Ü—ñ–≤',
          whatYouLearn: [
            'üèçÔ∏è –Ø–∫ –≤–∏–±—Ä–∞—Ç–∏ –ü–†–ê–í–ò–õ–¨–ù–ò–ô –ø–µ—Ä—à–∏–π –º–æ—Ç–æ—Ü–∏–∫–ª (–µ–∫–æ–Ω–æ–º—ñ—è $5,000-10,000)',
            'üìä –°–ø—ñ–≤–≤—ñ–¥–Ω–æ—à–µ–Ω–Ω—è –ø–æ—Ç—É–∂–Ω–æ—Å—Ç—ñ —Ç–∞ –¥–æ—Å–≤—ñ–¥—É –¥–ª—è –±–µ–∑–ø–µ—á–Ω–æ–≥–æ —Å—Ç–∞—Ä—Ç—É',
            'üí∞ –ë/—É vs –Ω–æ–≤–∏–π: —â–æ –Ω–∞—Å–ø—Ä–∞–≤–¥—ñ –≤–∏–≥—ñ–¥–Ω—ñ—à–µ –¥–ª—è –Ω–æ–≤–∞—á–∫–∞',
            'üõ°Ô∏è –§—ñ–ª–æ—Å–æ—Ñ—ñ—é –≤–∏–±–æ—Ä—É –µ–∫—ñ–ø—ñ—Ä—É–≤–∞–Ω–Ω—è: –∑–∞—Ö–∏—Å—Ç vs –∫–æ–º—Ñ–æ—Ä—Ç vs —Ü—ñ–Ω–∞',
            'ü™ñ –Ø–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—ñ–¥—ñ–±—Ä–∞—Ç–∏ —à–æ–ª–æ–º —Ç–∞ —á–æ–º—É —Ü–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –≤–∞–∂–ª–∏–≤–æ',
            'üëï –°–µ–∫—Ä–µ—Ç–∏ –≤–∏–±–æ—Ä—É –∑–∞—Ö–∏—Å–Ω–æ–≥–æ –æ–¥—è–≥—É —Ç–∞ –≤–∑—É—Ç—Ç—è',
            'üéØ –ü—Å–∏—Ö–æ–ª–æ–≥—ñ—á–Ω—É –ø—ñ–¥–≥–æ—Ç–æ–≤–∫—É —Ç–∞ –ø–æ–±—É–¥–æ–≤—É –≤–ø–µ–≤–Ω–µ–Ω–æ—Å—Ç—ñ',
            'üìç –ü–ª–∞–Ω—É–≤–∞–Ω–Ω—è –ø–µ—Ä—à–∏—Ö –±–µ–∑–ø–µ—á–Ω–∏—Ö –º–∞—Ä—à—Ä—É—Ç—ñ–≤ —Ç–∞ –ø–æ—ó–∑–¥–æ–∫'
          ],
          requirements: [
            'üÜî –ü—Ä–∞–≤–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó A –∞–±–æ A2 (–∞–±–æ –≤ –ø—Ä–æ—Ü–µ—Å—ñ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è)',
            'üí∞ –ë—é–¥–∂–µ—Ç $3,000-15,000 –Ω–∞ –º–æ—Ç–æ—Ü–∏–∫–ª —Ç–∞ –µ–∫—ñ–ø—ñ—Ä—É–≤–∞–Ω–Ω—è',
            'üß† –ì–æ—Ç–æ–≤–Ω—ñ—Å—Ç—å –≤—á–∏—Ç–∏—Å—è —Ç–∞ —Å–ª—ñ–¥—É–≤–∞—Ç–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è–º',
            '‚è∞ –ß–∞—Å –¥–ª—è –ø–æ—Å—Ç—É–ø–æ–≤–æ–≥–æ –≤—Ö–æ–¥–∂–µ–Ω–Ω—è –≤ –º–æ—Ç–æ—Ü–∏–∫–ª–µ—Ç–Ω–∏–π —Å–≤—ñ—Ç'
          ]
        };
      default:
        return {
          title: "–ö—É—Ä—Å –±–µ–∑–ø–µ–∫–∏ –º–æ—Ç–æ—Ü–∏–∫–ª—ñ—Å—Ç–∞",
          description: "–ù–∞–≤—á—ñ—Ç—å—Å—è –±–µ–∑–ø–µ—á–Ω–æ –∫–µ—Ä—É–≤–∞—Ç–∏ –º–æ—Ç–æ—Ü–∏–∫–ª–æ–º",
          longDescription: "–ü–æ–≤–Ω–∏–π –∫—É—Ä—Å –±–µ–∑–ø–µ–∫–∏ –º–æ—Ç–æ—Ü–∏–∫–ª—ñ—Å—Ç–∞",
          category: '–ó–∞–≥–∞–ª—å–Ω–∏–π',
          whatYouLearn: ['–û—Å–Ω–æ–≤–∏ –±–µ–∑–ø–µ–∫–∏'],
          requirements: ['–ë–∞–∑–æ–≤—ñ –Ω–∞–≤–∏—á–∫–∏']
        };
    }
  };

  const courseSpecificData = getCourseData(course.slug);

  // Transform course data for client component
  const courseData = {
    id: course.id,
    slug: course.slug,
    title: course.translations[0]?.title || courseSpecificData.title,
    description: course.translations[0]?.description || courseSpecificData.description,
    longDescription: course.translations[0]?.description || courseSpecificData.longDescription,
    category: courseSpecificData.category,
    difficulty: 'BEGINNER',
    duration: `${Math.ceil(totalDuration / 60)} –≥–æ–¥–∏–Ω`,
    totalHours: Math.ceil(totalDuration / 60),
    lessons: totalLessons,
    students: course.enrollments.length,
    rating: averageRating,
    totalReviews: course.reviews.length,
    isPremium: course.price > 0,
    price: course.price,
    testId: null,
    instructor: {
      name: '–ß–∏–Ω–≥—ñ–∑ –ë–∞—Ä—ñ–Ω–æ–≤',
      title: 'üèÜ –ó–∞—Å–Ω–æ–≤–Ω–∏–∫ –ù–µ–±–∞—á–∏–≤ | –ï–∫—Å–ø–µ—Ä—Ç –≤–∏–∂–∏–≤–∞–Ω–Ω—è –Ω–∞ –¥–æ—Ä–æ–∑—ñ',
      bio: 'üéØ 18 —Ä–æ–∫—ñ–≤ –º—ñ—Å—å–∫–æ—ó —ó–∑–¥–∏ | üìä 200,000+ –∫–º –ë–ï–ó –∞–≤–∞—Ä—ñ–π | üß† –ê–Ω–∞–ª—ñ–∑—É–≤–∞–≤ 1000+ —Ä–µ–∞–ª—å–Ω–∏—Ö –î–¢–ü | üí° –°—Ç–≤–æ—Ä–∏–≤ —Å–∏—Å—Ç–µ–º—É, —â–æ –≤—Ä—è—Ç—É–≤–∞–ª–∞ —Å–æ—Ç–Ω—ñ –∂–∏—Ç—Ç—ñ–≤',
      image: '/instructor.jpg'
    },
    whatYouLearn: course.translations[0]?.learningOutcomes 
      ? JSON.parse(course.translations[0].learningOutcomes) 
      : courseSpecificData.whatYouLearn,
    requirements: course.translations[0]?.requirements 
      ? JSON.parse(course.translations[0].requirements) 
      : courseSpecificData.requirements,
    sections: course.sections.map(section => ({
      id: section.id,
      title: section.title,
      description: section.description, // Add section description
      lessons: section.items.map(item => {
        const lessonProgress = userProgress.find(p => p.contentId === item.contentId)
        
        // Extract real lesson title from KB_NEB metadata
        let lessonTitle = `–£—Ä–æ–∫ ${item.order}`;
        if (item.content?.kbNebMetadata) {
          try {
            const metadata = JSON.parse(item.content.kbNebMetadata);
            lessonTitle = metadata.title || lessonTitle;
          } catch (e) {
            console.warn('Could not parse KB_NEB metadata for item', item.id);
          }
        }
        
        return {
          id: item.id,
          title: lessonTitle,
          duration: `15 —Ö–≤`,
          isCompleted: lessonProgress?.status === 'COMPLETED' || false,
          isFree: true
        }
      })
    }))
  }

  return (
    <CoursePageClient 
      course={courseData}
      isEnrolled={!!enrollment}
      progress={progress}
      session={session}
    />
  )
}